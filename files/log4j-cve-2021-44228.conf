[Definition]

# Option:  failregex
# Notes.:  regex to match the log4j-cve-2021-44228  attack.
# Values:  TEXT
# Test  :  fail2ban-regex /var/log/apache2/access.log /etc/fail2ban/filter.d/log4j-cve-2021-44228.conf '^<HOST> .*(\/admin\/reports\/dblog).*$'
# Check for false positives and decide which variant to use

# full expanded regex
#failregex = ^<HOST> .* "(GET|POST) .*((\?q=).*(jndi:(ldap|http|dns)|\${jndi:\${lower:l}\${lower:d}a\${lower:p}|http443useragent)).*HTTP/1\.(1|0).*


xploit = \$lower{jndi}|jndi\:(ldap|http|dns)|\${jndi\:\${lower\:l}\${lower\:d}a\${lower\:p}|http443useragent


failregex = ^<HOST> .* "(GET|POST|HEAD) .*(%(xploit)s).*HTTP/1\.[1|0].*$
            ^<HOST> .* "(GET|POST|HEAD) .*HTTP.*".*(%(xploit)s).*"$

# Option: ignoreregex
# Notes.: regex to ignore. If this regex matches, the line is ignored.
# Values: TEXT
ignoreregex = '^<HOST> .*(\/admin\/reports\/dblog).*$'